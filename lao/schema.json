{
  "dataset": {
    "name": "Harmonized Dengue-Climate-Population Dataset",
    "country_iso3": "LAO",
    "admin_level": 1,
    "temporal_resolution": "monthly",
    "primary_key": ["org_id", "period"],
    "time_range": "1998-01 to 2010-12",
    "description": "Monthly dengue cases harmonized with ERA5-Land climate covariates and WorldPop population at administrative level 1 (province)."
  },

  "spatial_reference": {
    "administrative_units": {
      "level": 1,
      "name_field": "shapeName",
      "crs": "EPSG:4326",
      "source": {
        "name": "OCHA Common Operational Dataset - Administrative Boundaries (COD-AB)",
        "dataset": "COD-AB-LAO",
        "provider": "United Nations Office for the Coordination of Humanitarian Affairs (OCHA) via HDX",
        "source_url": "https://data.humdata.org/dataset/cod-ab-lao",
        "notes": "Country-endorsed administrative boundary dataset used to define ADM1 geometries for all spatial aggregation."
      }
    }
  },

  "sources": [
    {
      "name": "OpenDengue",
      "source_url": "https://opendengue.org/data.html",
      "extract_type": "Spatial extract (V1.3)",
      "download_url": "https://github.com/OpenDengue/master-repo/raw/main/data/releases/V1.3/Spatial_extract_V1_3.zip",
      "use_in_dataset": ["dengue_cases"],
      "notes": "Spatially disaggregated dengue data availability varies by country; for Laos, ADM1 spatial data are available through 2010 in this extract."
    },
    {
      "name": "ERA5-Land",
      "provider": "ECMWF / Copernicus Climate Change Service (C3S)",
      "source_url": "https://cds.climate.copernicus.eu/",
      "use_in_dataset": ["t2m_mean_c_month", "tp_sum_mm_month", "rh2m_mean_month"],
      "notes": "Climate variables aggregated from gridded reanalysis to ADM1 polygons and to monthly temporal resolution."
    },
    {
      "name": "WorldPop",
      "provider": "WorldPop, University of Southampton",
      "source_url": "https://www.worldpop.org/",
      "use_in_dataset": ["population", "population_year"],
      "notes": "Population is derived by summing raster cell values within ADM1 polygons; population is static for the reference year indicated by population_year."
    },
    {
      "name": "OCHA COD-AB-LAO (HDX)",
      "source_url": "https://data.humdata.org/dataset/cod-ab-lao",
      "use_in_dataset": ["org_name", "org_id"],
      "notes": "Administrative boundaries used to define the spatial units for aggregation."
    }
  ],

  "processing_overview": {
    "health": {
      "temporal_aggregation": "Summed to monthly counts",
      "spatial_alignment": "Mapped to ADM1 using standardized names and crosswalk org_id"
    },
    "climate": {
      "temporal_aggregation": {
        "temperature": "Monthly mean",
        "precipitation": "Monthly sum",
        "relative_humidity": "Monthly mean"
      },
      "spatial_aggregation": "Area-weighted aggregation of gridded data to ADM1 polygons (weights ~ cos(latitude))",
      "unit_conversions": ["Temperature Kelvin → °C (if needed)", "Precipitation meters → millimeters"]
    },
    "population": {
      "spatial_aggregation": "Raster sum within ADM1 polygons",
      "temporal_handling": "Static snapshot for population_year"
    }
  },

  "fields": {
    "org_id": {
      "type": "string",
      "description": "Stable identifier for administrative unit (ADM1). Used for joins across dengue, climate, and population tables.",
      "source": {
        "name": "Derived",
        "inputs": ["OCHA COD-AB-LAO boundaries"],
        "details": "Generated during preprocessing and written to a crosswalk mapping ADM1 names to org_id."
      },
      "processing": {
        "artifact": "Crosswalk file (admin1_name_to_org_id.csv)",
        "method": "Deterministic ID assignment after name normalization and alias resolution."
      }
    },

    "org_name": {
      "type": "string",
      "description": "Human-readable name of the administrative unit (ADM1).",
      "source": {
        "name": "OCHA COD-AB-LAO",
        "provider": "OCHA via HDX",
        "source_url": "https://data.humdata.org/dataset/cod-ab-lao"
      },
      "processing": {
        "notes": "Names may be normalized for matching with health data sources."
      }
    },

    "period": {
      "type": "string",
      "format": "YYYY-MM",
      "description": "Calendar month of observation.",
      "source": {
        "name": "Derived",
        "inputs": ["OpenDengue calendar dates", "ERA5-Land time coordinate"],
        "details": "All variables aligned to monthly periods."
      }
    },

    "dengue_cases": {
      "type": "integer",
      "unit": "cases",
      "description": "Total reported dengue cases for the administrative unit during the month.",
      "source": {
        "name": "OpenDengue",
        "source_url": "https://opendengue.org/data.html",
        "extract_type": "Spatial extract (V1.3)",
        "download_url": "https://github.com/OpenDengue/master-repo/raw/main/data/releases/V1.3/Spatial_extract_V1_3.zip",
        "native_fields_example": ["adm_0_name", "adm_1_name", "adm_2_name", "dengue_total", "T_res", "S_res"],
        "native_resolution": "Administrative units; temporal resolution varies (Week/Month/Year)."
      },
      "processing": {
        "spatial": "Filtered to ADM1 for Laos; mapped to org_id using name normalization and alias mapping.",
        "temporal": "Monthly totals (sum).",
        "notes": "Dataset time range reflects availability of spatial dengue data for Laos in the spatial extract."
      }
    },

    "t2m_mean_c_month": {
      "type": "number",
      "unit": "°C",
      "description": "Mean 2-meter air temperature aggregated to month and ADM1.",
      "source": {
        "name": "ERA5-Land",
        "provider": "ECMWF / C3S",
        "source_url": "https://cds.climate.copernicus.eu/",
        "variable": "2m_temperature"
      },
      "processing": {
        "temporal": "Monthly mean",
        "spatial": "Area-weighted mean over ADM1 polygons",
        "unit_conversion": "Kelvin → Celsius (if needed)"
      }
    },

    "tp_sum_mm_month": {
      "type": "number",
      "unit": "mm",
      "description": "Total precipitation aggregated to month and ADM1.",
      "source": {
        "name": "ERA5-Land",
        "provider": "ECMWF / C3S",
        "source_url": "https://cds.climate.copernicus.eu/",
        "variable": "total_precipitation"
      },
      "processing": {
        "temporal": "Monthly sum",
        "spatial": "Area-weighted aggregation over ADM1 polygons",
        "unit_conversion": "meters → millimeters"
      }
    },

    "rh2m_mean_month": {
      "type": "number",
      "unit": "%",
      "description": "Mean relative humidity at 2 meters aggregated to month and ADM1.",
      "source": {
        "name": "Derived from ERA5-Land",
        "provider": "ECMWF / C3S",
        "source_url": "https://cds.climate.copernicus.eu/",
        "inputs": ["2m_temperature", "2m_dewpoint_temperature"]
      },
      "processing": {
        "method": "Magnus formula using monthly mean temperature and monthly mean dewpoint",
        "temporal": "Monthly mean",
        "spatial": "Area-weighted mean over ADM1 polygons",
        "range_constraints": "Clipped to [0, 100]"
      }
    },

    "population": {
      "type": "integer",
      "unit": "persons",
      "description": "Estimated population of the administrative unit (ADM1). Static across months for a given population_year.",
      "source": {
        "name": "WorldPop",
        "provider": "University of Southampton",
        "source_url": "https://www.worldpop.org/",
        "product": "Population counts raster (GeoTIFF)",
        "reference_year_field": "population_year"
      },
      "processing": {
        "spatial": "Sum of raster cell values within ADM1 polygons",
        "temporal": "Static snapshot",
        "notes": "To avoid future-data leakage for historical periods, prefer using a population_year within or before the analysis window when available."
      }
    },

    "population_year": {
      "type": "integer",
      "description": "Reference year for the population estimate used in the population raster.",
      "source": {
        "name": "WorldPop",
        "source_url": "https://www.worldpop.org/"
      }
    }
  },

  "limitations": [
    "Spatially disaggregated dengue data availability is limited by the OpenDengue spatial extract; for Laos, ADM1 spatial dengue data are available up to 2010.",
    "More recent dengue data may exist at national (ADM0) level but are not included here because they cannot be attributed to ADM1 units without additional modeling assumptions.",
    "Population is a static snapshot for population_year and does not vary by month."
  ],

  "reproducibility": {
    "config_file": "configs/LAO.yaml",
    "scripts": [
      "scripts/preprocessor.py",
      "scripts/download_era5_land.py",
      "scripts/aggregate_population.py",
      "scripts/aggregate_climate.py"
    ],
    "notes": "This schema describes the provenance and transformations applied by the pipeline; exact file paths and parameters are defined in the config file."
  }
}

